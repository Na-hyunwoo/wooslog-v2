name: Revalidate Cache

on:
  workflow_dispatch:
    # ìˆ˜ë™ìœ¼ë¡œ ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆê²Œ í•¨
    inputs:
      site_url:
        description: "Blog URL"
        required: true
        default: "https://devna.xyz"

jobs:
  revalidate:
    runs-on: ubuntu-latest
    steps:
      - name: Revalidate Next.js Cache
        id: revalidate
        run: |
          echo "ìš”ì²­ URL: ${{ inputs.site_url }}/api/revalidate"
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST ${{ inputs.site_url }}/api/revalidate \
            -H "Content-Type: application/json" \
            -d '{"revalidateKey": "${{ secrets.REVALIDATION_KEY }}"}')
          HTTP_STATUS=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$ d')
          echo "ì‘ë‹µ ìƒíƒœ ì½”ë“œ: $HTTP_STATUS"
          echo "ì‘ë‹µ ë‚´ìš©: $BODY"
          echo "response_body=$BODY" >> $GITHUB_OUTPUT
          echo "status_code=$HTTP_STATUS" >> $GITHUB_OUTPUT
          if [ "$HTTP_STATUS" -ge 200 ] && [ "$HTTP_STATUS" -lt 300 ]; then
            echo "âœ… ìºì‹œ ë¬´íš¨í™” ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
          else
            echo "âŒ ìºì‹œ ë¬´íš¨í™” ìš”ì²­ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
            exit 1
          fi

      - name: ê²°ê³¼ ìš”ì•½
        run: |
          echo "ğŸ“ ìºì‹œ ë¬´íš¨í™” ê²°ê³¼ ìš”ì•½"
          echo "----------------------------"
          echo "ìƒíƒœ ì½”ë“œ: ${{ steps.revalidate.outputs.status_code }}"
          echo "ì‘ë‹µ ë‚´ìš©: ${{ steps.revalidate.outputs.response_body }}"
          echo "ìš”ì²­ ì‹œê°„: $(date)"
          echo "----------------------------"
